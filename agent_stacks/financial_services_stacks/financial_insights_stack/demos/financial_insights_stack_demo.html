<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>M365 Copilot - Financial Insights Agent</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", -apple-system, BlinkMacSystemFont, system-ui,
          sans-serif;
        background: #faf9f8;
        height: 100vh;
        display: flex;
        overflow: hidden;
        color: #323130;
      }

      /* Sidebar */
      .sidebar {
        width: 260px;
        background: #ffffff;
        display: flex;
        flex-direction: column;
        border-right: 1px solid #edebe9;
      }

      /* Sidebar Header */
      .sidebar-header {
        padding: 12px 16px;
        display: flex;
        align-items: center;
        gap: 10px;
        border-bottom: 1px solid #edebe9;
        height: 48px;
      }

      .copilot-icon {
        width: 24px;
        height: 24px;
        background: linear-gradient(
          135deg,
          #b4a0ff 0%,
          #ff7eb9 50%,
          #7ee7fc 100%
        );
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
      }

      .copilot-icon::before {
        content: "";
        position: absolute;
        width: 12px;
        height: 12px;
        background: white;
        border-radius: 2px;
        opacity: 0.9;
      }

      .sidebar-title {
        font-size: 14px;
        font-weight: 600;
        color: #323130;
      }

      .sidebar-button {
        margin-left: auto;
        background: none;
        border: none;
        padding: 4px;
        cursor: pointer;
        color: #605e5c;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
        width: 32px;
        height: 32px;
      }

      .sidebar-button:hover {
        background: #f3f2f1;
      }

      /* Search Box */
      .search-container {
        padding: 8px 16px;
        border-bottom: 1px solid #edebe9;
      }

      .search-box {
        position: relative;
        width: 100%;
      }

      .search-icon {
        position: absolute;
        left: 8px;
        top: 50%;
        transform: translateY(-50%);
        color: #605e5c;
        font-size: 14px;
      }

      .search-input {
        width: 100%;
        padding: 6px 8px 6px 32px;
        border: 1px solid #d2d0ce;
        border-radius: 4px;
        font-size: 14px;
        background: #faf9f8;
        outline: none;
        transition: all 0.2s;
      }

      .search-input:focus {
        border-color: #605e5c;
        background: #ffffff;
      }

      /* Navigation */
      .nav-section {
        flex: 1;
        overflow-y: auto;
        padding: 4px 0;
      }

      .nav-item {
        padding: 8px 16px;
        display: flex;
        align-items: center;
        gap: 12px;
        cursor: pointer;
        font-size: 14px;
        color: #323130;
        transition: background 0.1s;
        position: relative;
        user-select: none;
      }

      .nav-item:hover {
        background: #f3f2f1;
      }

      .nav-item.active {
        background: #f3f2f1;
      }

      .nav-item.active::before {
        content: "";
        position: absolute;
        left: 0;
        top: 8px;
        bottom: 8px;
        width: 2px;
        background: #742774;
        border-radius: 1px;
      }

      .nav-icon {
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      /* Demo Controls Section */
      .demo-controls-section {
        border-top: 1px solid #edebe9;
        padding: 12px 16px;
        background: #faf9f8;
      }

      .demo-controls-title {
        font-size: 12px;
        font-weight: 600;
        color: #605e5c;
        margin-bottom: 8px;
      }

      .demo-controls {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
      }

      .demo-btn {
        padding: 6px 12px;
        border: 1px solid #d2d0ce;
        border-radius: 4px;
        background: white;
        font-size: 12px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
        color: #323130;
        transition: all 0.2s;
      }

      .demo-btn:hover:not(:disabled) {
        background: #f3f2f1;
        border-color: #605e5c;
      }

      .demo-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .demo-btn.primary {
        background: #742774;
        color: white;
        border-color: #742774;
      }

      .demo-btn.primary:hover:not(:disabled) {
        background: #5a1d5a;
      }

      /* Bottom section */
      .sidebar-bottom {
        border-top: 1px solid #edebe9;
        padding: 8px 0;
      }

      .user-section {
        padding: 8px 16px;
        display: flex;
        align-items: center;
        gap: 12px;
        cursor: pointer;
        transition: background 0.1s;
      }

      .user-section:hover {
        background: #f3f2f1;
      }

      .user-avatar {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: #742774;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 600;
      }

      /* Main Content */
      .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        background: #faf9f8;
      }

      /* Header */
      .content-header {
        height: 48px;
        padding: 0 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: #ffffff;
        border-bottom: 1px solid #edebe9;
      }

      .header-title {
        font-size: 14px;
        color: #605e5c;
      }

      .header-actions {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .status-indicator {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 12px;
        background: #f3f2f1;
        border-radius: 4px;
        font-size: 12px;
        color: #605e5c;
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #10b981;
      }

      .status-dot.processing {
        background: #f59e0b;
        animation: pulse 1s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      /* Chat Container */
      .chat-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      /* Chat Messages */
      .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        display: block;
      }

      .message {
        max-width: 900px;
        margin: 0 auto 24px;
      }

      .message-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 8px;
      }

      .message-avatar-user {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: #00a651;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 600;
      }

      .message-avatar-agent {
        width: 28px;
        height: 28px;
        border-radius: 6px;
        background: linear-gradient(135deg, #742774 0%, #00a651 100%);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: 600;
      }

      .message-author {
        font-size: 14px;
        font-weight: 600;
        color: #323130;
      }

      .message-tag {
        padding: 2px 8px;
        background: #f3f2f1;
        border-radius: 4px;
        font-size: 12px;
        color: #605e5c;
      }

      .message-time {
        font-size: 12px;
        color: #a19f9d;
      }

      .message-content {
        margin-left: 40px;
        font-size: 14px;
        line-height: 1.6;
        color: #323130;
      }

      /* Agent Cards */
      .agent-card {
        margin-left: 40px;
        margin-top: 16px;
        background: white;
        border: 1px solid #edebe9;
        border-radius: 8px;
        overflow: hidden;
      }

      .agent-card-header {
        padding: 16px;
        display: flex;
        align-items: center;
        gap: 12px;
        border-bottom: 1px solid #edebe9;
        background: linear-gradient(
          135deg,
          rgba(116, 39, 116, 0.05) 0%,
          rgba(0, 166, 81, 0.05) 100%
        );
      }

      .agent-card-icon {
        font-size: 20px;
      }

      .agent-card-title {
        font-size: 16px;
        font-weight: 600;
        color: #323130;
      }

      .agent-card-status {
        margin-left: auto;
        padding: 4px 12px;
        background: #10b981;
        color: white;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
      }

      .agent-card-content {
        padding: 16px;
      }

      .detail-list {
        list-style: none;
      }

      .detail-item {
        padding: 8px 0;
        font-size: 14px;
        color: #323130;
        display: flex;
        gap: 8px;
        border-bottom: 1px solid #f3f2f1;
      }

      .detail-item:last-child {
        border-bottom: none;
      }

      .detail-label {
        font-weight: 600;
        min-width: 180px;
        color: #605e5c;
      }

      .detail-value {
        color: #323130;
        flex: 1;
      }

      /* Input Container */
      .input-container {
        padding: 16px 20px;
        background: white;
        border-top: 1px solid #edebe9;
      }

      .input-wrapper {
        max-width: 900px;
        margin: 0 auto;
        position: relative;
      }

      .input-field {
        width: 100%;
        padding: 12px 48px 12px 16px;
        border: 1px solid #d2d0ce;
        border-radius: 8px;
        font-size: 14px;
        font-family: inherit;
        resize: none;
        outline: none;
        background: #faf9f8;
        transition: all 0.2s;
        min-height: 44px;
        max-height: 120px;
      }

      .input-field:focus {
        border-color: #742774;
        background: white;
      }

      .input-actions {
        position: absolute;
        right: 8px;
        bottom: 8px;
        display: flex;
        gap: 4px;
      }

      .input-button {
        width: 28px;
        height: 28px;
        border: none;
        background: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
        color: #605e5c;
        transition: all 0.1s;
      }

      .input-button:hover {
        background: #f3f2f1;
      }

      .input-button.send {
        color: #742774;
      }

      .input-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      /* Typing indicator */
      .typing-indicator {
        margin-left: 40px;
        display: flex;
        gap: 4px;
        padding: 8px 0;
      }

      .typing-dot {
        width: 8px;
        height: 8px;
        background: #605e5c;
        border-radius: 50%;
        animation: typing 1.4s infinite;
      }

      .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
      }

      .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes typing {
        0%,
        60%,
        100% {
          transform: translateY(0);
          opacity: 0.5;
        }
        30% {
          transform: translateY(-10px);
          opacity: 1;
        }
      }

      /* Welcome state - hidden when chat is active */
      .welcome-screen {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 40px;
        max-width: 1200px;
        margin: 0 auto;
        width: 100%;
      }

      .welcome-screen.hidden {
        display: none;
      }

      .welcome-title {
        font-size: 36px;
        font-weight: 600;
        color: #323130;
        margin-bottom: 16px;
        text-align: center;
      }

      .welcome-subtitle {
        font-size: 16px;
        color: #605e5c;
        margin-bottom: 48px;
        text-align: center;
      }

      .suggestion-cards {
        display: flex;
        gap: 20px;
        width: 100%;
        max-width: 900px;
      }

      .suggestion-card {
        flex: 1;
        background: white;
        border: 1px solid #edebe9;
        border-radius: 8px;
        padding: 20px;
        cursor: pointer;
        transition: all 0.2s;
        min-height: 120px;
      }

      .suggestion-card:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
        border-color: #742774;
      }

      .card-icon {
        font-size: 24px;
        margin-bottom: 12px;
      }

      .card-title {
        font-size: 14px;
        font-weight: 600;
        color: #323130;
        margin-bottom: 8px;
      }

      .card-description {
        font-size: 13px;
        color: #605e5c;
        line-height: 1.4;
      }

      .badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
      }
      .badge.success {
        background: #d4edda;
        color: #155724;
      }
      .badge.warning {
        background: #fff3cd;
        color: #856404;
      }
      .badge.danger {
        background: #f8d7da;
        color: #721c24;
      }
      .badge.info {
        background: #d1ecf1;
        color: #0c5460;
      }
      .trend-up {
        color: #10b981;
      }
      .trend-down {
        color: #dc2626;
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <div class="copilot-icon"></div>
        <span class="sidebar-title">M365 Copilot</span>
        <button class="sidebar-button">☰</button>
      </div>

      <div class="search-container">
        <div class="search-box">
          <span class="search-icon">🔍</span>
          <input type="text" class="search-input" placeholder="Search" />
        </div>
      </div>

      <div class="nav-section">
        <div class="nav-item active">
          <div class="nav-icon">💬</div>
          <span>Chat</span>
        </div>
        <div class="nav-item">
          <div class="nav-icon">🤖</div>
          <span>Agents</span>
        </div>
        <div class="nav-item">
          <div class="nav-icon">💬</div>
          <span>Conversations</span>
        </div>
        <div class="nav-item">
          <div class="nav-icon">📄</div>
          <span>Pages</span>
        </div>
        <div class="nav-item">
          <div class="nav-icon">➕</div>
          <span>Create</span>
        </div>
        <div class="nav-item">
          <div class="nav-icon">📱</div>
          <span>Apps</span>
        </div>
        <div class="nav-item">
          <div class="nav-icon">⚙️</div>
          <span>Admin</span>
        </div>
      </div>

      <!-- Demo Controls -->
      <div class="demo-controls-section">
        <div class="demo-controls-title">Demo Controls</div>
        <div class="demo-controls">
          <button class="demo-btn primary" onclick="startDemo()" id="startBtn">
            ▶️ Start
          </button>
          <button class="demo-btn" onclick="pauseDemo()" id="pauseBtn" disabled>
            ⏸️ Pause
          </button>
          <button class="demo-btn" onclick="resetDemo()" id="resetBtn">
            🔄 Reset
          </button>
          <button class="demo-btn" onclick="skipToNext()" id="skipBtn" disabled>
            ⏭️ Skip
          </button>
        </div>
      </div>

      <div class="sidebar-bottom">
        <div class="user-section">
          <div class="user-avatar">FA</div>
          <span style="font-size: 14px">Financial Advisor</span>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="content-header">
        <div class="header-title">Financial Insights Agent</div>
        <div class="header-actions">
          <div class="status-indicator">
            <span class="status-dot" id="statusDot"></span>
            <span id="statusText">Ready</span>
          </div>
        </div>
      </div>

      <div class="chat-container">
        <!-- Welcome Screen -->
        <div class="welcome-screen" id="welcomeScreen">
          <h1 class="welcome-title">💹 Financial Insights Agent</h1>
          <p class="welcome-subtitle">
            Real-Time Portfolio Intelligence & Wealth Management
          </p>

          <div class="suggestion-cards">
            <div class="suggestion-card" onclick="quickStart('scenario1')">
              <div class="card-icon">📊</div>
              <div class="card-title">Portfolio Analysis</div>
              <div class="card-description">Complete portfolio review</div>
            </div>
            <div class="suggestion-card" onclick="quickStart('scenario2')">
              <div class="card-icon">⚡</div>
              <div class="card-title">Risk Assessment</div>
              <div class="card-description">Stress testing & hedging</div>
            </div>
            <div class="suggestion-card" onclick="quickStart('scenario3')">
              <div class="card-icon">🎯</div>
              <div class="card-title">Retirement Planning</div>
              <div class="card-description">Timeline optimization</div>
            </div>
          </div>
        </div>

        <!-- Chat Messages -->
        <div class="chat-messages" id="chatMessages" style="display: none">
          <!-- Messages will be dynamically added here -->
        </div>

        <!-- Input Container -->
        <div class="input-container">
          <div class="input-wrapper">
            <textarea
              class="input-field"
              id="messageInput"
              placeholder="Type your message here..."
              rows="1"
              onkeypress="handleKeyPress(event)"
              oninput="autoResize(this)"
            ></textarea>
            <div class="input-actions">
              <button class="input-button">📎</button>
              <button
                class="input-button send"
                onclick="sendCurrentMessage()"
                id="sendButton"
              >
                ➤
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // State
      let demoState = {
        isPlaying: false,
        isPaused: false,
        currentStep: 0,
        messageTimer: null,
        typingTimer: null,
      };

      // Demo script - Financial Insights with simplified timing
      const demoScript = [
        {
          type: "user",
          content:
            "Analyze my client James Richardson's portfolio. He's 52, planning early retirement at 58. Current net worth $4.2M, but worried about market volatility. Need full risk analysis and optimization strategy.",
          delay: 1000,
        },
        {
          type: "agent",
          content:
            "Analyzing James Richardson's $4.2M portfolio with focus on early retirement readiness, risk assessment, and market volatility protection. Pulling real-time data from all accounts and running Monte Carlo simulations.",
          agentData: {
            title: "Portfolio Analysis Complete",
            status: "Active",
            details: {
              "Current Age": "52 years",
              "Target Retirement": "58 years (6 years)",
              "Net Worth": "$4,247,800",
              "Annual Income": "$385,000",
              "Savings Rate": "63.1%",
              "Risk Tolerance":
                '<span class="badge warning">Moderate (shifting conservative)</span>',
              "Taxable Accounts": "$2,180,500 (51.3%)",
              "401(k) Traditional": "$987,300 (23.2%)",
              "Roth IRA": "$412,000 (9.7%)",
              "Real Estate": "$590,000 (13.9%)",
              HSA: "$78,000 (1.8%)",
              "Tax Efficiency Score":
                '<span class="badge success">8.7/10</span>',
              "Portfolio Beta": "1.18 (High correlation)",
              "Standard Deviation": "16.8% annually",
              "Value at Risk (95%)": "-$714,432 monthly",
              "Sharpe Ratio": "1.34 (Good)",
              "Maximum Drawdown": "-31% (historical)",
              "Volatility Protection":
                '<span class="badge danger">34% - Inadequate</span>',
            },
          },
          typingTime: 2000,
          delay: 2000,
        },
        {
          type: "user",
          content:
            "This volatility exposure concerns me. What specific hedging strategies would you recommend? Also run a stress test for a 2008-style crisis hitting when he's 57.",
          delay: 1500,
        },
        {
          type: "agent",
          content:
            "Developing comprehensive hedging strategies and running detailed stress test for 2008-style crisis scenario occurring at age 57 (1 year before planned retirement).",
          agentData: {
            title: "Risk Analysis & Stress Test",
            status: "Complete",
            details: {
              "Protective Puts": "Buy 6-month puts on SPY for $1.2M",
              Cost: "~$28,000 quarterly (0.66%)",
              "Collar Strategy": "Zero-cost collar on tech ($487K)",
              "Covered Calls": "Generate $8,200/month premium",
              "Treasury Ladder": "Build $500K 1-5 year ladder",
              "Gold Allocation": "Add 3% position ($127,434)",
              "Crisis Initial Value": "$5,421,000 (projected)",
              "Crisis Bottom": "-37.2% (-$2,016,612)",
              "Portfolio at Bottom": "$3,404,388",
              "With Hedging": "$3,891,245 (23% less loss)",
              "Recovery Timeline": "28 months → 18 with hedging",
              "Retirement Impact": "Delay 3.5 years → 1 year with protection",
              "Q1 2025": "Rebalance to 55/45, implement puts",
              "Q2 2025": "Tax loss harvest, start Roth ladder",
              "Q3 2025": "Build bond ladder, add REITs",
              "Q4 2025": "Review and adjust hedges",
            },
          },
          typingTime: 2500,
          delay: 2000,
        },
        {
          type: "user",
          content:
            "Compare this to keeping his current allocation versus your optimized strategy. What's the mathematical difference in outcomes? Include tax implications.",
          delay: 1500,
        },
        {
          type: "agent",
          content:
            "Running comparative Monte Carlo analysis with 10,000 simulations comparing current allocation versus optimized strategy. Including comprehensive tax modeling.",
          agentData: {
            title: "Strategy Comparison Analysis",
            status: "Complete",
            details: {
              "Expected at 58": "Current: $5.8M | Optimized: $6.3M",
              "Worst Case (5%)": "Current: $3.1M | Optimized: $4.2M",
              "Best Case (95%)": "Current: $8.9M | Optimized: $8.1M",
              "Success Rate": "Current: 76% | Optimized: 91%",
              "Risk-Adjusted Return": "Current: 8.2% | Optimized: 7.8%",
              "Downside Protection": "Current: -37% | Optimized: -19%",
              "Current Tax Drag": "$127,800/year",
              "Optimized Efficiency": "$71,200/year",
              "Tax Savings": "$56,600 annually",
              "Roth Opportunity": "$412,000 over 6 years",
              "Total Tax Alpha": "1.34% additional return",
              "NPV Difference": "+$847,230 optimized",
              "IRR Improvement": "+1.82% annualized",
              "Sharpe Ratio Change": "1.34 → 1.71",
              "Recovery Time": "28 months → 14 months",
              "Legacy at 85": "+$2.3M optimized",
            },
          },
          typingTime: 2500,
          delay: 2000,
        },
        {
          type: "user",
          content:
            "Excellent. Now show me what automated rules and alerts I should set up in the portfolio management system to execute this plan without constant monitoring.",
          delay: 1500,
        },
        {
          type: "agent",
          content:
            "Configuring comprehensive automated portfolio management rules with intelligent alerts, rebalancing triggers, and protective actions for hands-off execution.",
          agentData: {
            title: "Automation Rules Configured",
            status: "Active",
            details: {
              "Drift Tolerance": "±5% from target allocation",
              "Frequency Check": "Daily monitoring, monthly execution",
              "Tax-Aware Logic": "Harvest losses first, FIFO in taxable",
              "Minimum Trade": "$10,000 to avoid excess fees",
              "Asset Priority": "1. Bonds, 2. Large Cap, 3. International",
              "Portfolio Drawdown": "Alert -5%, Action -8%, Stop -12%",
              "VIX Spike": "Alert >25, Hedge >30, Full protection >40",
              "Correlation Alert": "S&P correlation >0.90 for 5 days",
              "Loss Harvesting": "Auto-execute at $5,000 loss",
              "Wash Sale Prevention": "30-day lockout on similar",
              "Roth Conversion": "Monthly $5,667 conversions",
              "Covered Calls": "Auto-write at 5% OTM, 30-45 DTE",
              "Income Target": "Alert if projected <$200K",
              Distribution: "Monthly transfer $17,500",
              "Flash Crash": "If -5% intraday, halt trading",
              "Black Swan": "Portfolio insurance at -15%",
              "Circuit Breaker": "Stop if 3 triggers hit",
              "Manual Override": "SMS approval for >$100K",
              "AI Monitoring": "ML anomaly detection active",
            },
          },
          typingTime: 3000,
          delay: 2000,
        },
      ];

      let currentMessageIndex = 0;

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        console.log("Financial Insights Agent initialized");
      });

      // Auto resize textarea
      function autoResize(textarea) {
        textarea.style.height = "auto";
        textarea.style.height = Math.min(textarea.scrollHeight, 120) + "px";
      }

      // Handle key press
      function handleKeyPress(event) {
        if (event.key === "Enter" && !event.shiftKey) {
          event.preventDefault();
          sendCurrentMessage();
        }
      }

      // Quick start from cards
      function quickStart(type) {
        let message = "";
        switch (type) {
          case "scenario1":
            message = "Analyze portfolio performance and risk metrics";
            break;
          case "scenario2":
            message = "Run stress test scenarios on current holdings";
            break;
          case "scenario3":
            message = "Create retirement planning timeline";
            break;
        }

        document.getElementById("messageInput").value = message;
        sendCurrentMessage();
      }

      // Send current message
      function sendCurrentMessage() {
        const input = document.getElementById("messageInput");
        const message = input.value.trim();
        if (message) {
          // Hide welcome screen and show chat
          document.getElementById("welcomeScreen").classList.add("hidden");
          document.getElementById("chatMessages").style.display = "block";

          // Add user message
          addMessage("user", message);

          input.value = "";
          autoResize(input);

          // Simulate agent response
          setTimeout(() => {
            showTypingIndicator();
            setTimeout(() => {
              hideTypingIndicator();
              addMessage(
                "agent",
                "I'll help you with that. Please use the demo controls to see a full demonstration of the Financial Insights Agent capabilities for portfolio analysis and wealth management."
              );
            }, 1500);
          }, 500);
        }
      }

      // Demo controls
      function startDemo() {
        if (demoState.isPlaying && !demoState.isPaused) return;

        demoState.isPlaying = true;
        demoState.isPaused = false;

        document.getElementById("startBtn").disabled = true;
        document.getElementById("pauseBtn").disabled = false;
        document.getElementById("skipBtn").disabled = false;

        updateStatus("processing", "Running Demo...");

        // Hide welcome and show chat
        document.getElementById("welcomeScreen").classList.add("hidden");
        document.getElementById("chatMessages").style.display = "block";

        if (currentMessageIndex === 0) {
          document.getElementById("chatMessages").innerHTML = "";
        }

        playNextMessage();
      }

      function pauseDemo() {
        demoState.isPaused = true;
        document.getElementById("startBtn").disabled = false;
        document.getElementById("pauseBtn").disabled = true;

        clearTimeout(demoState.messageTimer);
        clearTimeout(demoState.typingTimer);

        updateStatus("idle", "Paused");
      }

      function resetDemo() {
        clearTimeout(demoState.messageTimer);
        clearTimeout(demoState.typingTimer);

        demoState.isPlaying = false;
        demoState.isPaused = false;
        currentMessageIndex = 0;

        document.getElementById("startBtn").disabled = false;
        document.getElementById("pauseBtn").disabled = true;
        document.getElementById("skipBtn").disabled = true;

        updateStatus("idle", "Ready");

        // Show welcome screen
        document.getElementById("welcomeScreen").classList.remove("hidden");
        document.getElementById("chatMessages").style.display = "none";
        document.getElementById("chatMessages").innerHTML = "";
      }

      function skipToNext() {
        clearTimeout(demoState.messageTimer);
        clearTimeout(demoState.typingTimer);
        hideTypingIndicator();

        if (currentMessageIndex < demoScript.length) {
          const message = demoScript[currentMessageIndex];
          addDemoMessage(message);
          currentMessageIndex++;

          if (currentMessageIndex < demoScript.length) {
            demoState.messageTimer = setTimeout(() => {
              playNextMessage();
            }, 1000);
          } else {
            completeDemo();
          }
        }
      }

      function playNextMessage() {
        if (!demoState.isPlaying || demoState.isPaused) return;

        if (currentMessageIndex >= demoScript.length) {
          completeDemo();
          return;
        }

        const message = demoScript[currentMessageIndex];

        if (message.type === "agent") {
          showTypingIndicator();
          demoState.typingTimer = setTimeout(() => {
            hideTypingIndicator();
            addDemoMessage(message);
            currentMessageIndex++;

            const delay = message.delay || 2000;
            demoState.messageTimer = setTimeout(() => {
              playNextMessage();
            }, delay);
          }, message.typingTime || 2000);
        } else {
          addDemoMessage(message);
          currentMessageIndex++;

          const delay = message.delay || 1500;
          demoState.messageTimer = setTimeout(() => {
            playNextMessage();
          }, delay);
        }
      }

      function addDemoMessage(message) {
        if (message.type === "user") {
          addMessage("user", message.content);
        } else if (message.type === "agent") {
          addMessage("agent", message.content, message.agentData);
        }
      }

      function addMessage(type, content, agentData) {
        const chatMessages = document.getElementById("chatMessages");
        const messageDiv = document.createElement("div");
        messageDiv.className = "message";

        const time = new Date().toLocaleString("en-US", {
          hour: "numeric",
          minute: "2-digit",
        });

        if (type === "user") {
          messageDiv.innerHTML = `
                    <div class="message-header">
                        <div class="message-avatar-user">FA</div>
                        <span class="message-author">Financial Advisor</span>
                        <span class="message-time">${time}</span>
                    </div>
                    <div class="message-content">${content}</div>
                `;
        } else {
          let html = `
                    <div class="message-header">
                        <div class="message-avatar-agent">💹</div>
                        <span class="message-author">Financial Insights</span>
                        <span class="message-tag">Agent</span>
                        <span class="message-time">${time}</span>
                    </div>
                    <div class="message-content">${content}</div>
                `;

          if (agentData) {
            html += `
                        <div class="agent-card">
                            <div class="agent-card-header">
                                <span class="agent-card-icon">📊</span>
                                <span class="agent-card-title">${
                                  agentData.title
                                }</span>
                                ${
                                  agentData.status
                                    ? `<span class="agent-card-status">${agentData.status}</span>`
                                    : ""
                                }
                            </div>
                            <div class="agent-card-content">
                                <ul class="detail-list">
                    `;

            for (const [key, value] of Object.entries(agentData.details)) {
              html += `
                            <li class="detail-item">
                                <span class="detail-label">${key}:</span>
                                <span class="detail-value">${value}</span>
                            </li>
                        `;
            }

            html += `
                                </ul>
                            </div>
                        </div>
                    `;
          }

          messageDiv.innerHTML = html;
        }

        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      function showTypingIndicator() {
        const chatMessages = document.getElementById("chatMessages");
        const indicator = document.createElement("div");
        indicator.id = "typingIndicator";
        indicator.className = "typing-indicator";
        indicator.innerHTML = `
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            `;
        chatMessages.appendChild(indicator);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      function hideTypingIndicator() {
        const indicator = document.getElementById("typingIndicator");
        if (indicator) {
          indicator.remove();
        }
      }

      function updateStatus(status, text) {
        const statusDot = document.getElementById("statusDot");
        const statusText = document.getElementById("statusText");

        statusDot.className = `status-dot ${status}`;
        statusText.textContent = text;
      }

      function completeDemo() {
        demoState.isPlaying = false;
        document.getElementById("startBtn").disabled = false;
        document.getElementById("pauseBtn").disabled = true;
        document.getElementById("skipBtn").disabled = true;

        updateStatus("idle", "Demo Complete");
      }
    </script>
  </body>
</html>
